<ion-content class="c-padding-top">

  <mat-vertical-stepper [linear]="true" #stepper labelPosition="bottom">
    <mat-step label="Accounts transaction" [optional]="false" [stepControl]="transferForm">

      <div style="padding-top: 3%;">
        <form [formGroup]="transferForm">
          <!-- <ng-template matStepLabel>Name</ng-template> -->
          <div class="example-form">
            <mat-form-field class="example-full-width">
              <mat-label>From account</mat-label>
              <textarea matInput placeholder="From account" readonly formControlName="transferF"
                [disabled]="true"></textarea>
              <input type="hidden" [value]="currentOperation.idAccount" required formControlName="idAccount">
              <button id="open-leaf" mat-mini-fab matSuffix aria-label="Search" (click)="openMode('from')">
                <mat-icon color="primary">search</mat-icon>
              </button>
              <div *ngIf="isError1A()"
                class="mat-mdc-form-field-error mat-mdc-form-field-bottom-align ng-tns-c4048155087-65 ng-star-inserted">

                <div>enter a valid first account tranfer </div>
              </div>
            </mat-form-field>

            <mat-form-field class="example-full-width">
              <mat-label>Transfer to account</mat-label>
              <textarea matInput placeholder="Transfer to account" formControlName="transfer" required
                readonly></textarea>
              <button mat-mini-fab matSuffix aria-label="Search" (click)="openMode('to')">
                <mat-icon color="primary">search</mat-icon>
              </button>
              <div *ngIf="isError1B()"
                class="mat-mdc-form-field-error mat-mdc-form-field-bottom-align ng-tns-c4048155087-65 ng-star-inserted">

                <div>enter a valid second account tranfer </div>
              </div>
            </mat-form-field>
          </div>
          <button (click)="transferForm.reset()" mat-raised-button color="accent" style="float: right;">RESET</button>
        </form>
      </div>

    </mat-step>

    <mat-step label="Transaction details" [stepControl]="operationForm" errorMessage="Name is required.">
      <div style="padding-top: 3%;">
        <form [formGroup]="operationForm">
          <!-- <ng-template matStepLabel>Name</ng-template> -->
          <mat-form-field class="example-full-width">
            <mat-label>Date</mat-label>
            <input matInput placeholder="Date" readonly formControlName="time">

            <button id="open-leaf" mat-mini-fab matSuffix aria-label="Date" id="open-modal">
              <mat-icon color="primary">calendar_month</mat-icon>
            </button>
            <div *ngIf="isError1A()"
              class="mat-mdc-form-field-error mat-mdc-form-field-bottom-align ng-tns-c4048155087-65 ng-star-inserted">

              <div>enter a valid first account tranfer </div>
            </div>
          </mat-form-field>

          <mat-form-field class="example-full-width">
            <mat-label>statut</mat-label>
            <input matInput placeholder="Statut" readonly formControlName="statut">
            <div *ngIf="isError1A()"
              class="mat-mdc-form-field-error mat-mdc-form-field-bottom-align ng-tns-c4048155087-65 ng-star-inserted">

              <div>enter a valid first account tranfer </div>
            </div>
          </mat-form-field>

          <mat-form-field class="example-full-width">
            <mat-label>Description</mat-label>
            <input matInput placeholder="Description" formControlName="description">
            <mat-error *ngIf="operationForm.get('description')?.hasError('required')">
              Description is required!
            </mat-error>
          </mat-form-field>
          <mat-form-field class="example-full-width">
            <mat-label>Debit</mat-label>
            <input dir="rtl" matInput type="number" formControlName="debit" placeholder="0" step="0.01"
              (change)="debitChanged($event)">
            <span class="prefix-currency" matTextPrefix>$&nbsp;</span>
            <mat-error *ngIf="operationForm.hasError('noMatch')">
              Debit and Credit can't be equal to 0 at same time
            </mat-error>
          </mat-form-field>

          <mat-form-field class="example-full-width">
            <mat-label>Credit</mat-label>
            <input dir="rtl" matInput type="number" formControlName="credit" placeholder="0" step="0.01"
              (change)="creditChanged($event)">
            <span class="prefix-currency" matTextPrefix>$&nbsp;</span>
          </mat-form-field>
        </form>
      </div>
    </mat-step>

    <mat-step label="Resumé">
      <div>
        <form>
          <ion-list>
            <ion-item>
              <ion-label for="accountIn" position="floating">First Account: </ion-label>

              <ion-textarea for="accountIn" label="Regular textarea" readonly
                [value]="defaultTransferFrom?.path"></ion-textarea>
            </ion-item>

            <ion-item>
              <ion-label for="accountFrom" position="floating">Second Account: </ion-label>

              <ion-textarea for="accountFrom" label="Regular textarea" readonly
                [value]="currentOperation.transfer"></ion-textarea>
            </ion-item>

            <ion-item>
              <ion-label for="timeD" position="floating">Date : </ion-label>

              <ion-input for="timeD" label="Time" readonly [value]="getFormattedDate(
            this.currentOperation.time,
            'yyyy-MM-dd HH:mm:ss'
          )"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label for="statutD" position="floating">Statut : </ion-label>

              <ion-input for="statutD" label="Statut" readonly [value]="currentOperation.statut"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label for="descriptionD" position="floating">Description : </ion-label>

              <ion-textarea for="descriptionD" label="Description" readonly
                [value]="currentOperation.description"></ion-textarea>
            </ion-item>

          </ion-list>

          <ion-item>
            <ion-label for="debitD">Debit : </ion-label>

            <ion-input dir="rtl" for="debitD" label="Debit" readonly [value]="currentOperation.debit | currency
                                :'CAD':'symbol-narrow':'1.2-2'
                                "></ion-input>
          </ion-item>

          <ion-item>
            <ion-label for="creditD">Credit : </ion-label>

            <ion-input dir="rtl" for="creditD" label="Credit" readonly [value]="currentOperation.credit | currency
                                          :'CAD':'symbol-narrow':'1.2-2'
                                          "></ion-input>
          </ion-item>

        </form>
      </div>
    </mat-step>
  </mat-vertical-stepper>
  <div class="ion-padding form-tool">
    <button mat-raised-button (click)="back()" style="float: left;"
      [disabled]="swiperRef?.selectedIndex === 0">BACK</button>
    <button mat-raised-button color="primary" (click)="next()"
      style="float: right;">{{ this.swiperRef?.selectedIndex === 2 ? 'SUBMIT' : 'NEXT'}}</button>
  </div>


  <!--
  <form [formGroup]="operationForm">
    <error-message message="les champs debit et credit ne peuvent pas tre a 0 en même temps"
      *ngIf="!isCreditAndDebitValide"></error-message>

    <ion-item>
      <ion-label for="accountIn" position="stacked">Account: </ion-label>

      <div id="accountIn">
        <ion-input class="transInput" type="text" readonly [value]="account?account.acountName:''" slot="start">
        </ion-input>
        <ion-button fill="clear" slot="end" *ngIf="!edit" id="">
          <ion-icon slot="end" name="list-outline"></ion-icon>
        </ion-button>
      </div>

    </ion-item>

    <ion-item>
      <ion-label for="num-trans" position="stacked">Numero Transaction: </ion-label>
      <ion-input id="num-trans" type="text" formControlName="numTrans" readonly></ion-input>
    </ion-item>

    <ion-item>
      <ion-label for="time" position="stacked">Time :</ion-label>
      <ion-input id="time" type="text" formControlName="time" readonly>
      </ion-input>

      <ion-button id="open-modal" fill="clear" slot="end">
        <ion-icon slot="icon-only" name="calendar-outline"></ion-icon>
      </ion-button>

    </ion-item>

    <ng-container *ngFor="let validation of validation_messages['time']">
      <error-message [message]="validation.message" *ngIf="isError('time',validation.type)"></error-message>
    </ng-container>

    <ion-item>
      <ion-label for="statut" position="floating">Statut: </ion-label>
      <ion-input id="statut" type="text" formControlName="statut" value="r"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label for="description" position="stacked">Description: </ion-label>
      <ion-input id="description" type="text" formControlName="description" class="form-controll"></ion-input>
    </ion-item>

    <ion-item id="open-leaf">
      <ion-label for="transferToDiv" position="stacked">Transfer to: </ion-label>
      <div id="transferToDiv">

        <ion-input class="transInput" type="text" readonly
          [value]="!edit ? defaultTransferTo?.acountName: currentOperation.transfer" slot="start">
        </ion-input>
        <ion-button fill="clear" slot="end" *ngIf="!edit" id="tranferToModal">
          <ion-icon slot="end" name="list-outline"></ion-icon>
        </ion-button>
      </div>

    </ion-item>

    <ion-item>
      <ion-label class="capitelize" for="debit"
        position="stacked">{{'forms.operation.'+accountType+'.debit' | translate}}: </ion-label>
      <number-input *ngIf="operationForm" id="debit" [precision]="2" [amount]="0" formControlName="debit"
        [formGroup]="operationForm" (amountEntered)="debitChanged($event)" ngDefaultControl
        style="width: 100%;margin-top: 10px;"></number-input>
    </ion-item>
    <ng-container *ngFor="let validation of validation_messages['debit']">
      <error-message [message]="validation.message" *ngIf="isError('debit',validation.type)"></error-message>
    </ng-container>

    <ion-item>
      <ion-label class="capitelize" for="credit"
        position="stacked">{{'forms.operation.'+accountType+'.credit' | translate}}: </ion-label>
      <number-input *ngIf="operationForm" id="credit" [precision]="2" [amount]="0" formControlName="credit"
        [formGroup]="operationForm" (amountEntered)="creditChanged($event)" ngDefaultControl
        style="width: 100%;margin-top: 10px;"></number-input>
    </ion-item>

    <ng-container *ngFor="let validation of validation_messages['credit']">
      <error-message [message]="validation.message" *ngIf="isError('credit',validation.type)"></error-message>
    </ng-container>
  </form>
-->
  <ion-modal trigger="open-modal">
    <ng-template>

      <ion-content class="ion-padding">
        <ion-datetime #datetime [showDefaultButtons]="true" (ionCancel)="cancel()"
          [value]="operation.time | dateHissab  " (ionChange)="onDateChange(datetime.value)"></ion-datetime>
      </ion-content>
    </ng-template>
  </ion-modal>


  <ion-modal #modal [isOpen]="isModalOpen" *ngIf="!edit" [initialBreakpoint]=".85" [breakpoints]="[ 0.85]"
    [backdropBreakpoint]="0.85">
    <ng-template>

      <ion-content>
        <ion-toolbar>
          <ion-title>{{modalTitle}}</ion-title>
          <ion-buttons slot="end">
            <ion-button color="light" (click)="modal.dismiss(); isModalOpen = false">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
        <ion-searchbar placeholder="Search" (click)="modal.setCurrentBreakpoint(0.75)" [(ngModel)]="searchText"
          (ionChange)="search($event)"></ion-searchbar>
        <ion-content>
          <ion-progress-bar *ngIf="progressShown" type="indeterminate" color="danger"></ion-progress-bar>

          <ion-list class="operation-details">
            <ion-radio-group [allowEmptySelection]="true"
              [value]="modalTitle === 'Transfer to' ? defaultTransferTo?defaultTransferTo.id:-5: defaultTransferFrom?defaultTransferFrom.id:-5"
              (ionChange)="onTransferChange($event)">
              <ion-item *ngFor="let item of leafsAccountFiltred" [id]="'item-leaf-'+item.id">
                <div>
                  <ion-label>{{item.acountName}}</ion-label>
                  <ion-label>{{item.path}}</ion-label>
                </div>

                <ion-radio slot="end" [value]="item.id"></ion-radio>
              </ion-item>
            </ion-radio-group>
          </ion-list>
        </ion-content>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>